<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geo Data AKR - Akkodis</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v8.2.0/ol.css">
    
    <style>
        /* ============================================================
            VARIABLES CSS GLOBALES
        ============================================================ */
        :root {
            --akkodis-dark: #001e2b;
            --akkodis-red: #ed1c24;
            --akkodis-white: #ffffff;
            --shadow: 0 4px 12px rgba(0,0,0,0.2);
            --btn-size: 34px;
        }

        /* ============================================================
            BODY ET LAYOUT PRINCIPAL
        ============================================================ */
        body { 
            font-family: 'Segoe UI', sans-serif; 
            margin: 0; 
            overflow: hidden; 
            display: flex; 
            flex-direction: column; 
            height: 100vh; 
        }

        /* ============================================================
            HEADER
        ============================================================ */
        header {
            background-color: var(--akkodis-dark);
            height: 70px;
            display: flex;
            align-items: center;
            padding: 0 25px;
            z-index: 3000;
        }
        .logo-akkodis { height: 35px; margin-right: 25px; }
        header h1 { 
            color: var(--akkodis-white); 
            font-size: 1.4rem; 
            border-left: 3px solid var(--akkodis-red); 
            padding-left: 20px; 
            text-transform: uppercase; 
            letter-spacing: 2px; 
            margin: 0; 
        }

        /* ============================================================
            CARTE
        ============================================================ */
        #map { 
            flex-grow: 1; 
            width: 100%; 
            position: relative; 
            background: #eee; 
        }

        /* ============================================================
            POPUP (NOUVEAU - ALIGNEMENT GRID)
        ============================================================ */
        .ol-popup {
            position: absolute;
            background-color: white;
            box-shadow: var(--shadow);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #cccccc;
            bottom: 12px;
            left: -50px;
            min-width: 260px;
            font-size: 13px;
            color: #333;
        }
        .ol-popup:after, .ol-popup:before {
            top: 100%;
            border: solid transparent;
            content: " ";
            height: 0;
            width: 0;
            position: absolute;
            pointer-events: none;
        }
        .ol-popup:after { border-top-color: white; border-width: 10px; left: 48px; margin-left: -10px; }
        .ol-popup:before { border-top-color: #cccccc; border-width: 11px; left: 48px; margin-left: -11px; }
        .ol-popup-closer { text-decoration: none; position: absolute; top: 2px; right: 8px; color: #999; font-size: 14px; }
        .ol-popup-closer:after { content: "‚úñ"; }
        
        .popup-title { 
            font-weight: bold; 
            color: var(--akkodis-dark); 
            border-bottom: 2px solid var(--akkodis-red); 
            margin-bottom: 10px; 
            padding-bottom: 5px; 
            text-transform: uppercase; 
            font-size: 12px; 
        }

        /* Grille pour aligner les labels et les valeurs */
        .popup-grid {
            display: grid;
            grid-template-columns: 95px 1fr; /* Colonne de gauche fixe pour les labels */
            row-gap: 6px;
            align-items: start;
        }
        .popup-label { 
            font-weight: bold; 
            color: #666; 
            font-size: 11px;
        }
        .popup-value { 
            font-size: 11px; 
            color: #333; 
            line-height: 1.3;
        }

        /* ============================================================
            RECHERCHE
        ============================================================ */
        .search-container {
            position: absolute;
            top: 15px;
            right: 60px;
            z-index: 2000;
            width: 380px;
        }
        input#address {
            width: 100%;
            padding: 12px 15px 12px 40px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: var(--shadow);
            outline: none;
            background: var(--akkodis-white) url('https://cdn-icons-png.flaticon.com/512/622/622669.png') no-repeat 12px center / 18px;
        }
        #suggestions {
            background-color: white !important;
            border-radius: 0 0 8px 8px;
            box-shadow: var(--shadow);
            display: none;
            max-height: 250px;
            overflow-y: auto;
            border: 1px solid #ddd;
            position: absolute;
            width: 100%;
            z-index: 2001;
        }
        .suggestion-item { 
            padding: 10px; 
            cursor: pointer; 
            border-bottom: 1px solid #eee; 
            font-size: 13px; 
        }
        .suggestion-item:hover { 
            background: #f8f8f8; 
            color: var(--akkodis-red); 
        }

        /* ============================================================
            WIDGET M√âT√âO
        ============================================================ */
        #weather-widget {
            position: absolute;
            top: 85px; 
            right: 60px;
            width: 190px;
            background: rgba(0, 32, 91, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: white;
            padding: 15px;
            border-radius: 12px;
            z-index: 2000;
            font-size: 13px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            border: 1px solid rgba(255, 255, 255, 0.15);
            display: none; 
            pointer-events: none;
        }
        .weather-title { font-weight: bold; font-size: 14px; margin-bottom: 5px; color: #00d4ff; }
        .weather-row { display: flex; justify-content: space-between; margin-bottom: 8px; align-items: center; }
        .wind-icon { display: inline-block; color: #00d4ff; font-weight: bold; font-size: 28px; text-shadow: 0 0 8px rgba(0,212,255,0.4); }

        /* ============================================================
            ZOOM ET WIDGETS
        ============================================================ */
        .ol-zoom {
            top: 15px !important;
            left: 15px !important;
            background: none !important;
            padding: 0 !important;
        }
        .ol-zoom button, .widget-btn {
            width: var(--btn-size) !important;
            height: var(--btn-size) !important;
            background-color: white !important;
            color: var(--akkodis-dark) !important;
            border: 1px solid #ccc !important;
            border-radius: 4px !important;
            cursor: pointer;
            display: flex !important;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
            font-size: 18px !important;
            font-weight: bold;
            padding: 0 !important;
            margin-bottom: 4px !important;
        }
        .widget-btn img { width: 25px; height: 25px; }

        .left-tools-stack {
            position: absolute;
            top: 91px;
            left: 15px;
            display: flex;
            flex-direction: column;
            z-index: 1000;
        }

        /* ============================================================
            MENUS FLOTTANTS
        ============================================================ */
        .floating-menu {
            position: absolute; 
            left: 42px; 
            top: 0; 
            background: white;
            border-radius: 4px; 
            box-shadow: var(--shadow); 
            display: none;
            min-width: 250px; 
            z-index: 1001; 
            border: 1px solid #ccc;
            max-height: 75vh; 
            overflow-y: auto; 
            overflow-x: hidden;
        }
        .floating-menu.active { display: block; }
        .menu-header { 
            background: var(--akkodis-dark); 
            color: white; 
            padding: 8px 10px; 
            font-size: 12px; 
            position: sticky; 
            top: 0;
            z-index: 10;
        }

        /* ============================================================
            TABLE ATTRIBUTAIRE
        ============================================================ */
        #open-table-btn {
            position: absolute; 
            bottom: 0; 
            left: 50%; 
            transform: translateX(-50%);
            z-index: 1500; 
            background: var(--akkodis-dark); 
            color: white;
            border: none; 
            padding: 5px 20px; 
            border-radius: 8px 8px 0 0; 
            cursor: pointer;
        }
        .table-panel {
            position: absolute; 
            bottom: -50vh; 
            left: 0; 
            width: 100%; 
            height: 35vh; 
            min-height: 200px;
            background: white; 
            z-index: 2500; 
            transition: bottom 0.4s ease;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.2); 
            display: flex; 
            flex-direction: column;
        }
        .table-panel.active { bottom: 0; }

        .table-toolbar {
            background: var(--akkodis-dark); 
            color: white; 
            padding: 8px 15px;
            display: flex; 
            align-items: center; 
            gap: 10px;
            flex-wrap: wrap; 
        }
        .table-toolbar input, .table-toolbar button, .table-toolbar select {
            font-size: 12px;
        }

        .table-container { flex-grow: 1; overflow: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; }
        th { 
            background: #f4f4f4; 
            position: sticky; 
            top: 0; 
            padding: 10px; 
            text-align: left; 
            border-bottom: 2px solid #ddd; 
            color: #333; 
        }
        td { padding: 8px 10px; border-bottom: 1px solid #eee; }
        tr:hover { background: #f9f9f9; cursor: pointer; }

    </style>
</head>

<body>

    <header>
        <img src="images/logo-akkodis.png" alt="Akkodis" class="logo-akkodis">
        <h1>Geo Data AKR</h1>
    </header>

    <div id="map">

        <div id="popup" class="ol-popup">
            <a href="#" id="popup-closer" class="ol-popup-closer"></a>
            <div id="popup-content"></div>
        </div>

        <div id="weather-widget"></div>

        <div class="search-container">
            <input type="text" id="address" placeholder="Rechercher un lieu..." autocomplete="off">
            <div id="suggestions"></div>
        </div>

        <div class="left-tools-stack">

            <button id="home-btn" class="widget-btn" title="Vue initiale">
                <img src="https://cdn-icons-png.flaticon.com/512/1946/1946436.png">
            </button>

            <div style="position:relative;">
                <button id="layer-btn" class="widget-btn" title="Fonds de plan">
                    <img src="images/map.png">
                </button>
                <div id="layer-menu" class="floating-menu">
                    <div class="menu-header">Fonds de Plan</div>
                    <div style="padding:10px; font-size:13px;">
                        <input type="radio" name="base" id="osm" checked> <label for="osm">Plan OSM</label><br>
                        <input type="radio" name="base" id="sat"> <label for="sat">Imagerie satellite</label><br>
                        <input type="radio" name="base" id="gray"> <label for="gray">Fond gris</label>
                    </div>
                </div>
            </div>

            <div style="position:relative;">
                <button id="data-layers-btn" class="widget-btn" title="Donn√©es">
                    <img src="https://cdn-icons-png.flaticon.com/512/1141/1141964.png">
                </button>
                <div id="data-layers-menu" class="floating-menu">
                    <div class="menu-header">Couches de donn√©es</div>
                    <div id="layers-list" style="padding:10px;"></div>
                </div>
            </div>
        </div>

        <button id="open-table-btn">‚ñ≤ Afficher les donn√©es</button>
        <div id="attribute-table" class="table-panel">

            <div class="table-toolbar">
                <select id="layer-selector" style="padding:4px; border-radius:4px;">
                    <option value="" disabled selected>Choisir une couche...</option>
                </select>
                <input type="text" id="filter-input" placeholder="Rechercher..." style="padding:2px 6px; border-radius:4px; border:1px solid #ccc;">
                <button id="filter-btn" style="padding:2px 6px; border-radius:4px; border:none; background:#007bff; color:white; cursor:pointer;">Filtrer</button>
                <button id="reset-filter-btn" style="padding:2px 6px; border-radius:4px; border:none; background:#6c757d; color:white; cursor:pointer;">R√©initialiser</button>
                
                <button id="filter-extent-btn" style="padding:2px 8px; border-radius:4px; border:none; background:#00d4ff; color:white; cursor:pointer; font-weight:bold;">üîç Zone</button>
                
                <span id="table-count" style="font-size:12px; margin-left:10px;"></span>
                <button id="export-btn" style="margin-left:auto; background:#28a745; color:white; border:none; padding:5px 12px; border-radius:4px; cursor:pointer;">Export CSV</button>
                <button id="close-table-btn" style="background:none; border:none; color:white; cursor:pointer; font-size:18px;">‚ñº</button>
            </div>

            <div class="table-container">
                <table>
                    <thead id="table-head"></thead>
                    <tbody id="table-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/ol@v8.2.0/dist/ol.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.11.0/proj4.js"></script>
    <script src="https://unpkg.com/@camptocamp/ogc-client@latest/dist/ogc-client.umd.js"></script>
    <script src="script.js"></script>

</body>
</html>